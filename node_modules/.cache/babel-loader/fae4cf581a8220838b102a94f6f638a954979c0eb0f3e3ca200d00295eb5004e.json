{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import supabase from'../../services/supabaseClient';import'./Task.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function QuickTaskInput(_ref){let{categories,onTaskAdded}=_ref;const[isExpanded,setIsExpanded]=useState(false);const[newTask,setNewTask]=useState({title:'',category_id:''});const[loading,setLoading]=useState(false);const inputRef=useRef(null);// フォーカス時に展開\nconst handleFocus=()=>{setIsExpanded(true);};// Enterキーでの素早い追加\nconst handleKeyPress=async e=>{if(e.key==='Enter'&&!e.shiftKey&&newTask.title.trim()){e.preventDefault();await handleQuickAdd();}};// Escapeキーで折りたたみ\nconst handleKeyDown=e=>{if(e.key==='Escape'){var _inputRef$current;setIsExpanded(false);setNewTask({title:'',category_id:''});(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.blur();}};// 素早いタスク追加\nconst handleQuickAdd=async()=>{if(!newTask.title.trim())return;setLoading(true);try{const{error}=await supabase.from('tasks').insert([{title:newTask.title.trim(),category_id:newTask.category_id||null,status:false}]);if(error){console.error('Supabase error:',error);throw error;}// リセット\nsetNewTask({title:'',category_id:''});setIsExpanded(false);onTaskAdded();// フォーカスを戻す\nsetTimeout(()=>{var _inputRef$current2;return(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.focus();},100);}catch(err){console.error('タスクの追加中にエラーが発生しました:',err);alert(`エラー: ${err.message}`);}finally{setLoading(false);}};// 外側クリックで折りたたみ\nuseEffect(()=>{const handleClickOutside=event=>{if(inputRef.current&&!inputRef.current.closest('.quick-input-container').contains(event.target)){if(!newTask.title.trim()){setIsExpanded(false);}}};document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[newTask.title]);return/*#__PURE__*/_jsxs(\"div\",{className:`quick-input-container ${isExpanded?'expanded':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-input-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",value:newTask.title,onChange:e=>setNewTask({...newTask,title:e.target.value}),onFocus:handleFocus,onKeyPress:handleKeyPress,onKeyDown:handleKeyDown,placeholder:isExpanded?\"何をしますか？ (Enter で追加)\":\"新しいタスクを入力...\",className:`quick-input ${loading?'loading':''}`,disabled:loading,autoComplete:\"off\"}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"input-spinner\",children:\"...\"})]}),isExpanded&&newTask.title.trim()&&/*#__PURE__*/_jsx(\"button\",{onClick:handleQuickAdd,disabled:loading,className:\"quick-add-btn main\",title:\"\\u8FFD\\u52A0\",children:\"\\u8FFD\\u52A0\"})]}),isExpanded&&categories.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"expanded-options\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"quick-options-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"quick-option\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u30AB\\u30C6\\u30B4\\u30EA\"}),/*#__PURE__*/_jsxs(\"select\",{value:newTask.category_id,onChange:e=>setNewTask({...newTask,category_id:e.target.value}),className:\"category-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u306A\\u3057\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"quick-tips\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"tips-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"tip\",children:\"Enter \\u3067\\u77AC\\u6642\\u8FFD\\u52A0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"tip\",children:\"Esc \\u3067\\u9589\\u3058\\u308B\"})]})})]})]});}export default QuickTaskInput;","map":{"version":3,"names":["React","useState","useRef","useEffect","supabase","jsx","_jsx","jsxs","_jsxs","QuickTaskInput","_ref","categories","onTaskAdded","isExpanded","setIsExpanded","newTask","setNewTask","title","category_id","loading","setLoading","inputRef","handleFocus","handleKeyPress","e","key","shiftKey","trim","preventDefault","handleQuickAdd","handleKeyDown","_inputRef$current","current","blur","error","from","insert","status","console","setTimeout","_inputRef$current2","focus","err","alert","message","handleClickOutside","event","closest","contains","target","document","addEventListener","removeEventListener","className","children","ref","type","value","onChange","onFocus","onKeyPress","onKeyDown","placeholder","disabled","autoComplete","onClick","length","map","category","id","name"],"sources":["C:/Users/mexer/PR/task-manager-app/src/components/Task/QuickTaskInput.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport supabase from '../../services/supabaseClient';\nimport './Task.css';\n\nfunction QuickTaskInput({ categories, onTaskAdded }) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [newTask, setNewTask] = useState({\n    title: '',\n    category_id: ''\n  });\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef(null);\n\n  // フォーカス時に展開\n  const handleFocus = () => {\n    setIsExpanded(true);\n  };\n\n  // Enterキーでの素早い追加\n  const handleKeyPress = async (e) => {\n    if (e.key === 'Enter' && !e.shiftKey && newTask.title.trim()) {\n      e.preventDefault();\n      await handleQuickAdd();\n    }\n  };\n\n  // Escapeキーで折りたたみ\n  const handleKeyDown = (e) => {\n    if (e.key === 'Escape') {\n      setIsExpanded(false);\n      setNewTask({ title: '', category_id: '' });\n      inputRef.current?.blur();\n    }\n  };\n\n  // 素早いタスク追加\n  const handleQuickAdd = async () => {\n    if (!newTask.title.trim()) return;\n\n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('tasks')\n        .insert([{\n          title: newTask.title.trim(),\n          category_id: newTask.category_id || null,\n          status: false\n        }]);\n\n      if (error) {\n        console.error('Supabase error:', error);\n        throw error;\n      }\n      \n      // リセット\n      setNewTask({ title: '', category_id: '' });\n      setIsExpanded(false);\n      onTaskAdded();\n      \n      // フォーカスを戻す\n      setTimeout(() => inputRef.current?.focus(), 100);\n    } catch (err) {\n      console.error('タスクの追加中にエラーが発生しました:', err);\n      alert(`エラー: ${err.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 外側クリックで折りたたみ\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (inputRef.current && !inputRef.current.closest('.quick-input-container').contains(event.target)) {\n        if (!newTask.title.trim()) {\n          setIsExpanded(false);\n        }\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [newTask.title]);\n\n  return (\n    <div className={`quick-input-container ${isExpanded ? 'expanded' : ''}`}>\n      {/* メイン入力欄 */}\n      <div className=\"main-input-row\">\n        <div className=\"input-wrapper\">\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={newTask.title}\n            onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}\n            onFocus={handleFocus}\n            onKeyPress={handleKeyPress}\n            onKeyDown={handleKeyDown}\n            placeholder={isExpanded ? \"何をしますか？ (Enter で追加)\" : \"新しいタスクを入力...\"}\n            className={`quick-input ${loading ? 'loading' : ''}`}\n            disabled={loading}\n            autoComplete=\"off\"\n          />\n          {loading && <div className=\"input-spinner\">...</div>}\n        </div>\n        \n        {/* 追加ボタン */}\n        {isExpanded && newTask.title.trim() && (\n          <button\n            onClick={handleQuickAdd}\n            disabled={loading}\n            className=\"quick-add-btn main\"\n            title=\"追加\"\n          >\n            追加\n          </button>\n        )}\n      </div>\n\n      {/* カテゴリ選択（必要時のみ表示） */}\n      {isExpanded && categories.length > 0 && (\n        <div className=\"expanded-options\">\n          <div className=\"quick-options-row\">\n            <div className=\"quick-option\">\n              <label>カテゴリ</label>\n              <select\n                value={newTask.category_id}\n                onChange={(e) => setNewTask({ ...newTask, category_id: e.target.value })}\n                className=\"category-select\"\n              >\n                <option value=\"\">なし</option>\n                {categories.map((category) => (\n                  <option key={category.id} value={category.id}>\n                    {category.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          {/* ヒント */}\n          <div className=\"quick-tips\">\n            <div className=\"tips-row\">\n              <span className=\"tip\">Enter で瞬時追加</span>\n              <span className=\"tip\">Esc で閉じる</span>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default QuickTaskInput;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}